(function(){$(function(){FastClick.attach(document.body)});var a=angular.module("msmApp",["ngRoute","ngSanitize","angulartics","angulartics.google.analytics"]);a.config(["$routeProvider","$logProvider",function(l,m){l.when("/",{templateUrl:"html/home.html"}).when("/about",{templateUrl:"html/about.html"}).when("/events",{templateUrl:"html/events.html"}).when("/biblestudy",{templateUrl:"html/biblestudy.html"}).when("/sundayschool",{templateUrl:"html/sundayschool.html"}).when("/initiative",{templateUrl:"html/initiative.html"}).when("/upcoming",{templateUrl:"html/upcoming.html"}).when("/news",{templateUrl:"html/news.html"}).when("/podcasts",{templateUrl:"html/podcasts.html"}).when("/contact",{templateUrl:"html/contact.html"}).when("/thankyou",{templateUrl:"html/thankyou.html"}).when("/blog",{templateUrl:"html/blog.html"}).otherwise({redirectTo:"/"});m.debugEnabled(true)}]);a.service("selectedService",function(){var m;var o={};var l=function(){return m};var n=function(q,p,r){if(p&&r){if(!o[p]){o[p]=""}o[p]=r}m=q;angular.forEach(o,function(t,s){})};return{getSelected:l,setSelected:n}});function b(l){var m;switch(l){case 0:m="January";break;case 1:m="February";break;case 2:m="March";break;case 3:m="April";break;case 4:m="May";break;case 5:m="June";break;case 6:m="July";break;case 7:m="August";break;case 8:m="September";break;case 9:m="October";break;case 10:m="November";break;case 11:m="December";break;default:m="Date Input Error"}return m}function f(l){var m;switch(l){case 0:m="Sunday";break;case 1:m="Monday";break;case 2:m="Tuesday";break;case 3:m="Wednesday";break;case 4:m="Thursday";break;case 5:m="Friday";break;case 6:m="Saturday";break;default:m="Date Input Error"}return m}function g(n){var m=/^\s*(\d{4})-(\d\d)-(\d\d)\s*$/,l=new Date(NaN),p,o=m.exec(n);if(o){p=+o[2];l.setFullYear(o[1],p-1,o[3]);if(p!=l.getMonth()+1){l.setTime(NaN)}}return l}function d(m,l){return Math.ceil((l-m)/86400000)}function k(m,l){if(m.getFullYear()!=l.getFullYear()){return false}if(m.getMonth()!=l.getMonth()){return false}if(m.getDate()!=l.getDate()){return false}return true}function h(m,l){return m.date<l.date?-1:m.date>l.date?1:0}function e(){}a.controller("TopBar",["$scope","$route","$location","selectedService",function(u,s,q,t){u.go=function(v){q.path(v)};u.sideBarItems=[{name:"Home",url:"#/",label:false,path:""},{name:"About Us",url:"#/about",label:false,path:"about"},{name:"Ministries",url:"#/events",label:false,path:"events"},{name:"Weekly Bible Study",url:"#/biblestudy",label:false,path:"biblestudy"},{name:"Sunday School",url:"#/sundayschool",label:false,path:"sundayschool"},{name:"The Multiply Initiative",url:"#/initiative",label:false,path:"initiative"},{name:"Upcoming Ministry Events",url:"#/upcoming",label:false,path:"upcoming"},{name:"News/Updates",url:"#/news",label:false,path:"news"},{name:"Podcasts",url:"#/podcasts",label:false,path:"podcasts"},{name:"Contact",url:"#/contact",label:false,path:"contact"}];u.items=[{name:"Home",url:"#/"},{name:"About Us",url:"#/about"},{name:"Ministries",url:"#/events"},{name:"News/Updates",url:"#/news"},{name:"Podcasts",url:"#/podcasts"},{name:"Contact",url:"#/contact"}];u.itemsLeft=[{name:"Home",url:"#/",dropdown:false,nested:[]},{name:"About Us",url:"#/about",dropdown:false,nested:[]}];u.itemsRight=[{name:"News/Updates",url:"#/news"},{name:"Podcasts",url:"#/podcasts"},{name:"Contact",url:"#/contact"}];var n=function(){u.selected=t.getSelected()};for(var p=0;p<u.items.length;p++){if(u.items[p].url==document.location.hash){u.selected=u.items[p]}}u.select=function(v){u.ministrySelected=false;u.selected=v;$(".top-bar").removeClass("expanded");m()};var l=false;var o=$("body");o.addClass("slide-from-side-closed");u.toggleSlide=function(){m()};function r(){var v=window.orientation;if(l===true){m()}}window.addEventListener("orientationchange",r);var m=function(){if(l===false){o.removeClass("slide-from-side-closed");o.addClass("slide-from-side-open")}else{o.removeClass("slide-from-side-open");o.addClass("slide-from-side-closed")}l=!l}}]);a.controller("SlidesController",function(){console.log("SlidesController");$(function(){console.log("run after doc load")})});a.controller("JoyrideController",["$scope",function(l){l.tour=function(){console.log("joyride controller working!")}}]);a.controller("InitializeController",[function(){$(document).foundation()}]);a.controller("NewHomeController",["$scope",function(l){l.slides=[{url:"",src:"img/slide0-MainSlide.png"},{url:"#/about",src:"img/slide1-Welcome.png"},{url:"",src:"img/slide1-Welcome.png"}];l.bullets=[{number:0},{number:1},{number:2}];l.selectedBullet=l.bullets[0];var m=Swipe(document.getElementById("slider"),{startSlide:0,speed:400,auto:5000,continuous:true,disableScroll:false,stopPropagation:false,callback:function(n,o){l.changeActive(n)},transitionEnd:function(n,o){}});l.changeActive=function(n){l.selectedBullet=l.bullets[n];if(!l.$$phase){l.$apply()}};l.click=function(n){l.selectedBullet=l.bullets[n.number];m.slide(n.number)};l.prevSlide=function(){m.prev()};l.nextSlide=function(){m.next()}}]);a.controller("HomeController",["$scope","httpService",function(m,o){var n="$$Upcoming Ministry Events";var l={};m.nextEvent;o.getLabeledPostRecursive(n).then(function(t,p,u,r){var q=new Date();angular.forEach(t.items,function(D,E){var w=D.title.indexOf(":");var v=D.title.substr(0,w);var C=D.title.substr(w+1,D.title.length);var z=g(v);var B=z.getDate();var x=f(z.getDay());var y=b(z.getMonth());var A=z.getFullYear();D.title=C;D.date=z;D.dateText=x+", "+y+" "+B;if(q>z){}else{if(A){if(!l[z]){l[z]=D}}}});var s;angular.forEach(l,function(w,v){if(!s){s=w.date}else{if(s>w.date){s=w.date}}});m.nextEvent=l[s]}).then(function(){o.resetRecursiveGet();var q="$News/Updates";m.currentNews;var r=new Array();var p=new Array();var s=new Array();var t={0:{title:"Current News/Updates",data:{}}};o.resetRecursiveGet();o.getLabeledPostRecursive(q).then(function(y,u,z,w){var v=new Date();angular.forEach(y.items,function(K,L){var C=K.title.indexOf(":");var B=K.title.substr(0,C);var J=K.title.substr(C+1,K.title.length);var G=g(B);var I=G.getDate();var D=f(G.getDay());var E=b(G.getMonth());var H=G.getFullYear();K.title=J;K.date=G;K.dateText="For "+D+", "+E+" "+I;if(K.labels.indexOf("Sunday School Update")>=0||K.labels.indexOf("Bible Study Update")>=0){var M=new Date(K.date.getTime()-(7*24*60*60*1000));K.date=M}var A=new Date(K.date.getTime()+(8*24*60*60*1000));var F=new Date(K.date.getTime()+(1*24*60*60*1000));if(K.date>v){}else{if(v>A){}else{if(K.labels.indexOf("Sunday School Update")>=0||K.labels.indexOf("Bible Study Update")>=0){if(v>F){p.push(K)}}else{p.push(K)}}}});t[0].data=p;angular.forEach(t,function(B,A){B.data.sort(h);B.data.reverse()});m.currentNews=t[0].data;angular.element(document).foundation("orbit",{});var x=(angular.element(".orbit-container img").first().height()+20);angular.element(".orbit-slides-container").css({"min-height":x});e()})})}]);a.controller("AboutController",["$log","$scope","httpService",function(p,n,q){n.options=[{value:0,title:"temp",content:"temp"},{value:1,title:"temp",content:"temp"}];n.switchOption=function(){if(n.currentOption!=null){if(n.currentOption.value===0){n.getMissionStatement()}else{if(n.currentOption.value===1){n.getOurYouthPastor()}}n.swipe.slide(n.currentOption.value)}};n.callback=function(r){n.currentOption=n.options[r];if(!n.$$phase){n.$apply()}};var m={missionStatement:{},ourYouthPastor:{}};var o;var l;q.resetSimpleGet();q.getLabeledPost("$About Us").then(function(r){if(r.items[0]&&r.items[1]){var s=r.items[0].labels[0];if(s.substr(0,1)==="$"){n.title=s.substr(1,s.length)}else{n.title="Page Error";return""}if(r.items[0].title==="Our Youth Pastor"){l=r.items[0];o=r.items[1]}else{l=r.items[1];o=r.items[0]}m.missionStatement.title=o.title;m.missionStatement.content=o.content;m.ourYouthPastor.title=l.title;m.ourYouthPastor.content=l.content;n.getMissionStatement();n.options[0].title=o.title;n.options[0].content=o.content;n.options[0].img="img/Smushed/about-us-1-banner.jpg";n.options[1].title=l.title;n.options[1].content=l.content;n.options[1].img="img/Smushed/about-us-2-banner.jpg";n.currentOption=n.options[0];n.createSwipe()}else{n.title="Page Error"}},function(r){p.error("AboutController: $About Us",r)});n.getMissionStatement=function(){n.subtitle=m.missionStatement.title;n.content=m.missionStatement.content;n.img="img/Smushed/about-us-1-banner.jpg";n.isMissionStatement=true;n.isOurYouthPastor=false};n.getOurYouthPastor=function(){n.subtitle=m.ourYouthPastor.title;n.content=m.ourYouthPastor.content;n.img="img/Smushed/about-us-2-banner.jpg";n.isMissionStatement=false;n.isOurYouthPastor=true}}]);a.controller("BibleStudyController",["$log","$scope","httpService",function(p,o,q){o.options=[{value:0,title:"temp",content:"temp"},{value:1,title:"temp",content:"temp"}];o.switchOption=function(){if(o.currentOption!=null){if(o.currentOption.value===0){o.getBibleStudyTemplate()}else{if(o.currentOption.value===1){o.getSundaySchoolTemplate()}}o.swipe.slide(o.currentOption.value)}};o.callback=function(r){o.currentOption=o.options[r];if(!o.$$phase){o.$apply()}};var m={bibleStudy:{},sundaySchool:{}};var n;var l;q.resetSimpleGet();q.getLabeledPost("$$Weekly Ministries").then(function(r){if(r.items[0]&&r.items[1]){var s=r.items[0].labels[0];if(s.substr(0,2)==="$$"){o.title="Weekly Bible Study"}else{o.title="Page Error";return""}if(r.items[0].title==="Weekly Bible Study"){n=r.items[0];l=r.items[1]}else{n=r.items[1];l=r.items[0]}m.sundaySchool.title=l.title;m.sundaySchool.content=l.content;m.bibleStudy.title=n.title;m.bibleStudy.content=n.content;o.getBibleStudyTemplate();o.options[0].title=l.title;o.options[0].content=l.content;o.options[0].img="img/Smushed/weekly-2-banner.jpg";o.options[0].mapLink="https://maps.google.com/maps?q=1411+kennoway+park,+Spring+TX,+77379&hl=en&sll=31.168934,-100.076842&sspn=10.237092,8.76709&hnear=1411+Kennoway+Park+Dr,+Spring,+Texas+77379&t=m&z=16";o.options[0].mapImg="http://maps.googleapis.com/maps/api/staticmap?center=24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&zoom=13&size=600x300&maptype=roadmap&markers=color:red%7Ccolor:red%7Clabel:A%7C24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&sensor=false";o.options[1].title=n.title;o.options[1].content=n.content;o.options[1].img="img/Smushed/weekly-1-banner.jpg";o.options[1].mapLink="https://maps.google.com/maps?q=24724+aldine+westfield,+spring+TX,+77373&hl=en&ll=30.065213,-95.401046&spn=0.010047,0.01457&sll=31.168934,-100.076842&sspn=10.762073,12.436523&hnear=24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&t=m&z=16";o.options[1].mapImg="http://maps.googleapis.com/maps/api/staticmap?center=1411+kennoway+park,+Spring+TX,+77379&zoom=14&size=600x300&maptype=roadmap&markers=color:red%7Ccolor:red%7Clabel:A%7C1411+kennoway+park,+Spring+TX,+77379&sensor=false";o.currentOption=o.options[0]}else{o.title="Page Error"}},function(r){p.error("WeeklyController: $$Weekly Ministries",r)});o.getBibleStudyTemplate=function(){o.image="img/Smushed/weekly-1-banner.jpg";o.subtitle=m.bibleStudy.title;o.content=m.bibleStudy.content;o.mapLink="https://maps.google.com/maps?q=1411+kennoway+park,+Spring+TX,+77379&hl=en&sll=31.168934,-100.076842&sspn=10.237092,8.76709&hnear=1411+Kennoway+Park+Dr,+Spring,+Texas+77379&t=m&z=16";o.mapImg="http://maps.googleapis.com/maps/api/staticmap?center=1411+kennoway+park,+Spring+TX,+77379&zoom=14&size=600x300&maptype=roadmap&markers=color:red%7Ccolor:red%7Clabel:A%7C1411+kennoway+park,+Spring+TX,+77379&sensor=false";o.isBibleStudy=true;o.isSundaySchool=false};o.getSundaySchoolTemplate=function(){o.image="img/Smushed/weekly-2-banner.jpg";o.subtitle=m.sundaySchool.title;o.content=m.sundaySchool.content;o.mapLink="https://maps.google.com/maps?q=24724+aldine+westfield,+spring+TX,+77373&hl=en&ll=30.065213,-95.401046&spn=0.010047,0.01457&sll=31.168934,-100.076842&sspn=10.762073,12.436523&hnear=24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&t=m&z=16";o.mapImg="http://maps.googleapis.com/maps/api/staticmap?center=24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&zoom=13&size=600x300&maptype=roadmap&markers=color:red%7Ccolor:red%7Clabel:A%7C24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&sensor=false";o.isBibleStudy=false;o.isSundaySchool=true}}]);a.controller("SundaySchoolController",["$log","$scope","$compile","httpService",function(q,l,o,r){l.title="Sunday School";l.subtitle="About";l.slideArray=[];var n=20;var p=20;l.isCurrent=true;l.activeSlide=0;l.maxVisible=n;l.lastVisible=p;l.loadSlide=function(s){l.activeSlide=s};l.loadArchives=function(){l.isCurrent=false;l.maxVisible=l.slideArray.length-l.maxVisible;l.lastVisible=l.slideArray.length};l.loadCurrent=function(){l.isCurrent=true;l.maxVisible=n;l.lastVisible=p};l.switchOption=function(){l.activeSlide=l.currentOption.index};l.loadTeacher=function(s){l.current=s;$("#myModal").foundation("reveal","open")};l.$watch("activeSlide",function(t,s){if(s!==t&&!isNaN(t)){l.currentOption=l.slideArray[t]}});l.teachers;l.current={};var m={appendPostInfo:function(v){var u=v.title.indexOf(":");var t=v.title.substr(0,u);var s=v.title.substr(u+1,v.title.length);v.name=s;v.gradeLevel=t;if(s.indexOf("Howard")>0){v.index=0;v.img="img/Smushed/bio-howard.jpg"}else{if(s.indexOf("Hurd")>0){v.index=1;v.img="img/Smushed/bio-hurd.jpg"}else{if(s.indexOf("Munns")>0){v.index=2;v.img="img/Smushed/bio-munns.jpg"}else{if(s.indexOf("Hull")>0){v.index=3;v.img="img/Smushed/bio-hull.jpg"}else{if(s.indexOf("Patino")>0){v.index=4;v.img="img/Smushed/bio-patino.jpg"}else{if(s.indexOf("Loftin")>0){v.index=5;v.img="img/Smushed/bio-loftin.jpg"}else{}}}}}}},removeContentTags:function(u){var t=u.content;t=t.replace(/&nbsp;/g," ");t=t.replace(/<br \/>|<br>/g,"<br/>");var s=/<div([^>]*)>|<\/div>|<span([^>]*)>|<\/span>|<p([^>]*)>|<\/p>/g;t=t.replace(s,"");var v='<span class="optimus">The Multiply Initiative</span>';t=t.replace(/The Multiply Initiative/g,v);u.content=t},getPostsSundaySchool:function(t){var s="$$$Sunday School";return r.getLabeledPost(s).then(function(x){if(!t){var w=x.items[0];if(x.items&&x.items[0]&&x.items[0].title==="About"){w=x.items[0]}else{w=x.items[1]}if(w){c(w);var u="img/Smushed/weekly-2-banner.jpg";var A='<img src="'+u+'" />';var z="https://maps.google.com/maps?q=1411+kennoway+park,+Spring+TX,+77379&hl=en&sll=31.168934,-100.076842&sspn=10.237092,8.76709&hnear=1411+Kennoway+Park+Dr,+Spring,+Texas+77379&t=m&z=16";var v="http://maps.googleapis.com/maps/api/staticmap?center=24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&zoom=13&size=600x300&maptype=roadmap&markers=color:red%7Ccolor:red%7Clabel:A%7C24724+Aldine+Westfield+Rd,+Spring,+Texas+77373&sensor=false";var y='<a href="'+z+'" target="_blank"> 				   								<img class="bordered-image" 				   									src="'+v+'"> 													</img> 												</a>';var B={heading:"Sunday School",index:0,title:w.title,date:"",content:A+w.content+y};l.slideArray.push(B);l.currentOption=l.slideArray[0];return false}else{q.error("SundaySchoolController:",s,"- null data");return true}}else{q.error("SundaySchoolController:",s,"- STOP Chaining");return true}},function(u){q.error("SundaySchoolController:",s,u)})},getPostsTeacherBios:function(t){var s="$$$Teacher Bios";return r.getLabeledPostRecursive(s).then(function(w){if(!t){var v=w.items[0];if(v){angular.forEach(w.items,function(z,y){m.removeContentTags(z);m.appendPostInfo(z)});w.items.sort(function(z,y){return z.index-y.index});l.teachers=w.items;var u='<div class"small-12 column"> 			   													<h3 style="margin: 0;">Teachers</h3> 			   													<h3 style="margin: 0;"><small>Click/Tap on Photos for Teacher Bios</small></h3> 				   												<ul class="small-block-grid-2 medium-block-grid-4 large-block-grid-2"> 														        <li ng-repeat="teacher in teachers" 														          ng-click="loadTeacher(teacher);"> 														          <img ng-src="{{teacher.img}}" style="width: 100%; margin-bottom: 10px;"> 														          <div style="background-color: #eee; color: #999; border-top: 2px solid #5A5A59; padding: 10px;"> 														            <h6 style="margin: 0;"><strong>{{ teacher.name }}</strong></h6> 														            <p style="margin: 0;">Grade: {{ teacher.gradeLevel }}</p> 														          </div> 														        </li> 														      </ul> 												        </div>';var x=o(u)(l);l.compiledElem=x;return false}else{q.error("SundaySchoolController:",s,"- null data");return true}}else{q.error("SundaySchoolController:",s,"- STOP Chaining");return true}},function(u){q.error("SundaySchoolController:",s,u)})},getPostsUpdates:function(t){var s="$$$Sunday School Posts";return r.getLabeledPostRecursive(s).then(function(v){if(!t){var u=v.items[0];if(u){angular.forEach(v.items,function(x,w){m.removeContentTags(x);c(x)});v.items.sort(h);v.items.reverse();angular.forEach(v.items,function(x,w){var y={heading:"Updates",index:w+1,title:x.title,date:x.dateText,content:x.content};l.slideArray.push(y)});return false}else{q.error("SundaySchoolController:",s,"- null data");return true}}else{q.error("SundaySchoolController:",s,"- STOP Chaining");return true}},function(u){q.error("SundaySchoolController:",s,u)})}};r.resetSimpleGet();m.getPostsSundaySchool().then(m.getPostsTeacherBios).then(m.getPostsUpdates).then(function(){q.debug("Promise Chaining is DONE!!!!")})}]);var c=function(t){var m=t.title.indexOf(":");var l=t.title.substr(0,m);var s=t.title.substr(m+1,t.title.length);var p=g(l);var r=p.getDate();var n=f(p.getDay());var o=b(p.getMonth());var q=p.getFullYear();t.title=s;t.date=p;t.dateText=n+", "+o+" "+r};var j=function(n){var m=n.content;m=m.replace(/&nbsp;/g," ");m=m.replace(/<br \/>|<br>/g,"<br/><br/>");var l=/<div([^>]*)>|<\/div>|<span([^>]*)>|<\/span>|<p([^>]*)>|<\/p>/g;m=m.replace(l,"");var o='<span class="optimus">The Multiply Initiative</span>';m=m.replace(/The Multiply Initiative/g,o);n.content=m};a.controller("InitiativeController",["$log","$scope","httpService",function(p,l,q){l.title="The Multiply Initiative";l.subtitle="Meditations";l.slideArray=[];var m=15;var o=15;l.isCurrent=true;l.activeSlide=0;l.maxVisible=m;l.lastVisible=o;l.loadSlide=function(r){l.activeSlide=r};l.loadArchives=function(){l.isCurrent=false;l.maxVisible=l.slideArray.length-l.maxVisible;l.lastVisible=l.slideArray.length};l.loadCurrent=function(){l.isCurrent=true;l.maxVisible=m;l.lastVisible=o};l.switchOption=function(){l.activeSlide=l.currentOption.index};var n=false;l.$watch("activeSlide",function(s,r){if(r!==s&&!isNaN(s)){l.currentOption=l.slideArray[s]}});q.resetSimpleGet();q.getLabeledPost("$$$The Multiply Initiative").then(function(s){var r=s.items[0];if(r){console.log("$$$The Multiply Initiative data",s);j(r);c(r);var t={heading:"About",index:0,title:r.title,date:"",content:r.content};l.slideArray.push(t)}else{n=true}},function(r){p.error("InitiativeController: $$$The Multiply Initiative",r)}).then(function(){if(!n){q.getLabeledPostRecursive("$$$Meditations").then(function(r){console.log("$$$Meditations data",r);angular.forEach(r.items,function(t,s){j(t);c(t)});p.debug("Sorting Blog Posts");r.items.sort(h);r.items.reverse();angular.forEach(r.items,function(t,s){var u={heading:"Meditations",index:s+1,title:t.title,date:t.dateText,content:t.content};l.slideArray.push(u)});l.currentOption=l.slideArray[0]},function(r){p.error("InitiativeController: $$$Meditations",r)})}})}]);a.controller("UpcomingController",["$scope","httpService",function(l,q){l.callback=function(r){};var p=function(s){s.imgLarge="img/Smushed/upcoming-default.jpg";s.visible=true;for(var r=0;r<s.labels.length;r++){if(s.title.indexOf("Youth Mission Trip")>-1){s.imgSmall="img/Smushed/upcoming-youth-mission-trip.jpg";s.imgLarge="img/Smushed/upcoming-youth-mission-trip.jpg";break}else{if(s.title.indexOf("Crawdad")>-1){s.imgSmall="img/Smushed/upcoming-crawdad-small.jpg";s.imgLarge="img/Smushed/upcoming-crawdad.jpg";s.visible=false;break}else{if(s.title.indexOf("Summer Lock-In")>-1){s.imgSmall="img/Smushed/upcoming-lock-in.jpg";s.imgLarge="img/Smushed/upcoming-lock-in.jpg";break}else{if(s.labels[r]==="Evangelism"){s.imgSmall="img/Smushed/upcoming-evangelism.jpg";s.imgLarge="img/Smushed/upcoming-evangelism.jpg";break}else{if(s.labels[r]==="Afterglow"){break}else{if(s.labels[r]==="Afterglow"){break}else{if(s.labels[r]==="Afterglow"){break}else{}}}}}}}}};var n="$$Upcoming Ministry Events";l.title=n.substr(2,n.length);var o={};var m={};l.allUpcomingEvents;q.resetRecursiveGet();q.getLabeledPostRecursive(n).then(function(s){var r=new Date();console.log("data",s);angular.forEach(s.items,function(B,D){var u=B.title.indexOf(":");var t=B.title.substr(0,u);var A=B.title.substr(u+1,B.title.length);var x=g(t);var C=g(t);C.setDate(C.getDate()+1);var z=x.getDate();var v=f(x.getDay());var w=b(x.getMonth());var y=x.getFullYear();B.title=A;B.date=x;B.dateText=v+", "+w+" "+z;p(B);if(r>C){if(!m[y]){m[y]={year:y,events:new Array()}}m[y].events.push(B)}else{if(y){if(!o[y]){o[y]={year:y,events:new Array()}}o[y].events.push(B)}}});angular.forEach(o,function(u,t){u.events.sort(h)});l.allUpcomingEvents=o;console.log("$scope",l)},function(r){$log.error("UpcomingController: $$Upcoming Ministry Events",r)})}]);var i=function(n){var m=n.content;m=m.replace(/&nbsp;/g," ");var l=/<div([^>]*)>|<\/div>|<span([^>]*)>|<\/span>|<p([^>]*)>|<\/p>|<h2([^>]*)>|<\/h2>|<h3([^>]*)>|<\/h3>|<h4([^>]*)>|<\/h4>/g;m=m.replace(l,"");var o='<span class="optimus">The Multiply Initiative</span>';m=m.replace(/The Multiply Initiative/g,o);n.content=m};a.controller("NewsController",["$log","$scope","httpService",function(o,l,p){l.title="News/Updates";l.slideArray=[];var m=15;var n=15;l.isCurrent=true;l.activeSlide=0;l.maxVisible=m;l.lastVisible=n;l.loadSlide=function(q){l.activeSlide=q};l.loadArchives=function(){l.isCurrent=false;l.maxVisible=l.slideArray.length-l.maxVisible;l.lastVisible=l.slideArray.length};l.loadCurrent=function(){l.isCurrent=true;l.maxVisible=m;l.lastVisible=n};l.switchOption=function(){l.activeSlide=l.currentOption.index};l.$watch("activeSlide",function(r,q){if(q!==r&&!isNaN(r)){l.currentOption=l.slideArray[r]}});p.resetRecursiveGet();p.getLabeledPostRecursive("$News/Updates").then(function(q){console.log("$News/Updates data",q);angular.forEach(q.items,function(s,r){i(s);c(s)});o.debug("Sorting Blog Posts");q.items.sort(h);q.items.reverse();angular.forEach(q.items,function(s,r){var t={index:r,title:s.title,date:s.dateText,content:s.content};l.slideArray.push(t)});l.currentOption=l.slideArray[0]},function(q){o.error("InitiativeController: $$$Meditations",q)})}]);a.controller("PodcastsController",["$log","$scope","httpService",function(p,l,r){angular.element("#audioPlayer").audioPlayer({classPrefix:"audioplayer",strPlay:"Play",strPause:"Pause",strVolume:"Volume"});var n=document.getElementById("audioPlayer");function o(s){n.src=s;n.load()}function q(){n.play()}l.callback=function(s){};l.playThis=function(s){if(l.allPodcasts){if(l.allPodcasts[s]){l.currentSermon=l.allPodcasts[s];var t=l.allPodcasts[s].dblink;o(t);l.prevSlide();q()}}};l.searchTypes=[{type:"By Title"},{type:"By Speaker"},{type:"By Series"}];l.searchType=l.searchTypes[0];l.show={title:true,speaker:false,series:false};l.switchType=function(){l.show.title=false;l.show.speaker=false;l.show.series=false;switch(l.searchType.type){case"By Title":l.show.title=true;break;case"By Speaker":l.show.speaker=true;break;case"By Series":l.show.series=true;break;default:break}};var m="$Podcasts";l.title=m.substr(1,m.length);l.allPodcasts={};r.resetSimpleGet();r.getLabeledPost(m).then(function(v){if(v.items[0]){var s=v.items[0].content;var u=s.toString();if(u){var t=JSON.parse(u);if(t){angular.forEach(t,function(x,w){var y=g(x.date);x.dayNumber=y.getDate();x.day=f(y.getDay());x.month=b(y.getMonth());if(isNaN(x.dayNumber)){x.month="No Date";x.dayNumber="";x.day=""}else{x.date=x.month+" "+x.dayNumber+", "+y.getFullYear()}});l.allPodcasts=t;if(l.allPodcasts){l.currentSermon=l.allPodcasts[0];if(l.currentSermon){o(l.currentSermon.dblink);l.createSwipe()}}}}}},function(s){p.error("PodcastsController: $Podcasts",s)})}]);a.controller("ContactController",["$log","$scope","httpService",function(m,l,n){n.resetSimpleGet();n.getLabeledPost("$Contact").then(function(p){if(p.items[0]){var o=p.items[0];l.title=o.title;l.content=o.content}else{l.title="Page Error"}e()},function(o){m.error("ContactController: $Contact",o)})}]);a.directive("infiniteSwipe",["$log","$compile",function(p,m){var n=function(z,u,x,v){p.debug("infinite-swipe scope",z);var q=500;var r=true;var y=true;var s={carousel:null,minLength:z.minLength,init:function(){if(z.fixedHeight){u.height(z.fixedHeight)}else{u.height(q)}s.carousel=new SwipeView(z.swipeElement[0],{numberOfPages:z.slides.length,hastyPageFlip:true,loop:false});z.swipeElement[0].style.overflowX="hidden";z.swipeElement[0].style.overflowY="scroll";s.loadInitialData();s.carousel.onFlip(s.onFlipHandler)},loadInitialData:function(){for(var A=0;A<3;A++){var C;if(A===0){C=z.slides.length}else{C=A-1}var B=document.createElement("div");B.className="infiniteSwipe";s.setSlideContent(B,z.slides[C]);if(C===0){z.heading=z.slides[C].heading}s.carousel.masterPages[A].appendChild(B)}},onFlipHandler:function(){var C;var A;for(var B=0;B<3;B++){A=s.carousel.masterPages[B].dataset.upcomingPageIndex;if(A!=s.carousel.masterPages[B].dataset.pageIndex){C=s.carousel.masterPages[B].querySelector("div");s.setSlideContent(C,z.slides[A])}}if(r&&!z.$$phase){z.$apply(function(){z.heading=z.slides[s.carousel.pageIndex].heading;z.activeIndex=s.carousel.pageIndex;y=false})}else{z.heading=z.slides[s.carousel.pageIndex].heading;z.activeIndex=s.carousel.pageIndex;r=true}},setSlideContent:function(B,C){if(C){var D="<h2>"+C.title+"</h2>";var A="<h3>"+C.date+"</h3>";B.innerHTML=D+A+C.content}}};var t=false;z.$watchCollection("slides",function(B,A){if(B&&B.length>=s.minLength){s.init();if(t){$("#swipeview-masterpage-1").append(z.compiledElem);t=false}}});z.$watch("activeIndex",function(B,A){if(y&&!isNaN(B)&&z.slides.length>=s.minLength){r=false;w(B)}y=true});z.$watch("compiledElem",function(B,A){if(B){t=true}});var w=function(A){s.carousel.goToPage(A)};z.nextSlide=function(){s.carousel.next()};z.prevSlide=function(){s.carousel.prev()};$(document).keyup(function(A){if(A.which===37){z.prevSlide()}if(A.which===39){z.nextSlide()}})};var l={priority:0,template:function(q,r){var s='<div style="height: 100%;"> 	    											<div class="clearfix" style="height: 112px;"> 												      <a class="no-text-select left" ng-click="prevSlide()"><i class="fi-arrow-left" style="color: #ff2701; font-size: 3em;"></i></a> 												      <a class="no-text-select right" ng-click="nextSlide()"><i class="fi-arrow-right" style="color: #ff2701; font-size: 3em;"></i></a> 												      <h1 class="text-center" style="margin: 0;">{{ heading }}</h1> 												      <h2 class="hide-for-touch text-center" style="margin: 0;"><small>Use arrow keys to navigate</small></h2> 												      <h2 class="show-for-touch text-center" style="margin: 0;"><small>Swipe or use arrow keys to navigate</small></h2> 												    </div> 	      										<div style="height: calc(100% - 112px); 	      											padding: 1.25rem; 											      	border-style: solid; 											      	border-width: 1px; 											      	border-color: #d9d9d9; 											      	background-color: #f2f2f2;"> 											      	<div ng-scope-element="swipeElement" 											      		style="height: 100%; 											      		-webkit-overflow-scrolling: touch; 											      		overflow-x: hidden !important; 											      		overflow-y: scroll !important;"> 										      		</div> 									      		</div>       										</div>';return s},transclude:false,restrict:"A",scope:{slides:"=",minLength:"=",activeIndex:"=",fixedHeight:"=",compiledElem:"="},compile:function o(r,s,q){return n}};return l}]);a.directive("swipejs",function(){return function(n,m,l){n.createSwipe=function(){n.swipe=Swipe(m[0],{startSlide:0,speed:400,auto:0,continuous:false,disableScroll:false,stopPropagation:false,callback:function(o,p){},transitionEnd:function(o,p){n.callback(o)}})};n.prevSlide=function(){n.swipe.prev()};n.nextSlide=function(){n.swipe.next()};$(document).keyup(function(o){if(o.which===37){n.prevSlide()}if(o.which===39){n.nextSlide()}})}});a.directive("swipeEvent",function(){return{restrict:"A",link:function(o,n,m,l){var p=true;o.createSwipe=function(){o.swipe=Swipe(n[0],{startSlide:0,speed:400,auto:0,continuous:false,disableScroll:false,stopPropagation:true,callback:function(q,r){},transitionEnd:function(q,r){}})};o.createSwipe();o.toggle=function(){if(p){o.swipe.next()}else{o.swipe.prev()}p=!p};o.prevSlide=function(){o.swipe.prev()};o.nextSlide=function(){o.swipe.next()}}}});a.directive("backImg",function(){return{restrict:"A",link:function(p,o,n,l){var m=n.backImg;p.setImg=function(){o.css({"background-image":"url("+m+")"})};p.setImg()}}});a.directive("newsItem",function(){return{restrict:"E",template:'<div class="expand-on-small panel hero shadowed-image"><div class="small-12 large-12 columns"><h3>{{news.title}}</h3><h4>{{news.dateText}}</h4><br/></div><div class="row transparent"><div class="small-12 large-12 columns"><div ng-bind-html="news.content" class="panel shadowed-image"></div></div></div></div>',replace:true,link:function(o,n,m,l){}}});a.directive("weeklyEvent",["$http","$compile","$location",function(n,l,m){return{restrict:"E",template:"<div></div>",controller:"weeklyController",link:function(r,p,o,t){var s=m.$$hash;var q="html/"+s+".html";if(s==="biblestudy"){r.isBibleStudy=true;r.isSundaySchool=false}else{if(s==="sundayschool"){r.isBibleStudy=false;r.isSundaySchool=true}}n.get(q).then(function(u){var v=u.data;p.html(v);l(p.contents())(r)});r.$watch("url",function(v,u){if(v){n.get(v).then(function(w){var x=w.data;p.html(x);l(p.contents())(r)})}})}}}]);a.directive("podcast",function(){return{restrict:"E",template:'<div class="podcasts small-12 large-12 columns panel shadowed-image"><div class="small-12 large-2 columns"><a href="#" class="button"><i class="foundiconacc-speaker"></i> Listen </a></div><div class="small-12 large-2 columns"><p>August 13, 2013</p></div><div class="small-12 large-6 columns"><h3>Nathan Ramirez</h3><h2>Final Camp Exhortation</h2></div><div class="small-12 large-2 columns"><a href="Nathan Camp Final Exortation.mp3"><i class="foundicongen-inbox"></i> Download </a></div></div>',link:function(){}}});a.directive("chosenPodcast",function(){return{restrict:"E",template:'<div style="height: 300px; background: #f5f4f0 url(\'img/Smushed/podcasts-art.jpg\') center top repeat-y; background-size: cover"><div class="small-12 medium-6 columns" style="height: 300px; overflow-y: scroll; color: #fff;"><h3 style="color: #fff;">{{currentSermon.title}}</h3><h4 style="color: #fff;">{{currentSermon.speaker}}</h4><h4 style="color: #fff;">{{currentSermon.series}}</h4><p>{{currentSermon.date}}</p><p><strong>Passage/Topic: {{currentSermon.passage}}</strong></p><p class="show-for-small">{{currentSermon.description}}</p></div><div class="hide-for-small small-12 medium-6 columns" style="height: 300px; overflow-y: scroll; color: #fff;"><p>{{currentSermon.description}}</p></div></div>',link:function(o,n,m,l){}}});a.directive("ngScopeElement",function(){var l={restrict:"A",compile:function m(o,p,n){return{pre:function q(t,u,s,r){t[s.ngScopeElement]=u}}}};return l});a.controller("FeedCtrl",["$scope","httpService",function(l,m){l.loadButonText="Load";l.posts;m.getBlogPosts().success(function(p,n,q,o){console.log("posts",p);l.posts=p.items}).error(function(p,n,q,o){});m.getBlog().success(function(p,n,q,o){console.log("blog",p.items);l.blog=p.items}).error(function(p,n,q,o){})}]);a.service("httpService",["$log","$http","$q",function(q,s,n){var m=this;var l="AIzaSyBwh5B3d-nVf8Ut6mf690Id5miFFQ01s0M";var p="1357003820482584675";m.getBlog=function(){var t="https://www.googleapis.com/blogger/v3/blogs/"+p+"?key="+l+"&callback=JSON_CALLBACK";return s.jsonp(t)};m.getBlogPosts=function(){var t="https://www.googleapis.com/blogger/v3/blogs/"+p+"/posts?maxPosts=9999&key="+l+"&callback=JSON_CALLBACK";return s.jsonp(t)};var r={deferred:null,mainLabel:"",container:{items:new Array()},getPost:function(){var t="https://www.googleapis.com/blogger/v3/blogs/"+p+"/posts?maxResults=20&labels="+r.mainLabel+"&fields=nextPageToken,items(title,published,labels,content)&key="+l+"&callback=JSON_CALLBACK";s.jsonp(t).success(function(w,u,x,v){r.container.items.push.apply(r.container.items,w.items);r.deferred.resolve(r.container)}).error(function(w,u,x,v){q.error("httpService: simpleGet",w)})},resetGet:function(){r.deferred=n.defer();r.mainLabel="";r.container={items:new Array()}}};m.getLabeledPost=function(t){r.resetGet();r.deferred=n.defer();r.mainLabel=t;r.getPost();return r.deferred.promise};m.resetSimpleGet=function(){r.resetGet()};var o={deferred:null,mainLabel:"",container:{items:new Array()},getPost:function(v,t){var u="https://www.googleapis.com/blogger/v3/blogs/"+p+"/posts?maxResults=20";if(t){u+="&pageToken="+t}u+="&labels="+o.mainLabel+"&fields=nextPageToken,items(title,published,labels,content)&key="+l+"&callback=JSON_CALLBACK";s.jsonp(u).success(function(y,w,z,x){o.container.items.push.apply(o.container.items,y.items);if(y.nextPageToken){o.getPost(o.mainLabel,y.nextPageToken)}else{o.deferred.resolve(o.container)}}).error(function(y,w,z,x){})},resetGet:function(){o.deferred=n.defer();o.mainLabel="";o.container={items:new Array()}}};m.getLabeledPostRecursive=function(u,t){o.resetGet();o.deferred=n.defer();o.mainLabel=u;o.getPost();return o.deferred.promise};m.resetRecursiveGet=function(){o.resetGet()}}])})();